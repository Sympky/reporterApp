import { ColumnDef } from "@tanstack/react-table";
import { type FC } from "react";

export type Vulnerability = {
  id: number;
  project_id: number;
  project_name: string;
  client_name: string;
  name: string;
  description: string;
  severity: string;
  cve: string;
  cvss: number | null;
  remediation: string | null;
  discovered_at: string;
};

// Placeholder components that will be replaced by the actual components from vulnerabilities/index.tsx
export const EditVulnerabilityDialog: FC<{ vulnerability: Vulnerability }> = () => null;
export const DeleteVulnerabilityButton: FC<{ vulnerability: Vulnerability }> = () => null;

export const vulnerabilityColumns: ColumnDef<Vulnerability>[] = [
  {
    accessorKey: "client_name",
    header: "Client"
  },
  {
    accessorKey: "project_name",
    header: "Project"
  },
  {
    accessorKey: "name",
    header: "Title"
  },
  {
    accessorKey: "severity",
    header: "Severity",
    cell: ({ getValue }) => {
      const severity = getValue() as string | null;
      if (!severity) return "—"; // Em dash for null/undefined values
      
      let colorClass = "bg-gray-100 text-gray-800";
      
      switch (severity.toLowerCase()) {
        case "critical":
          colorClass = "bg-red-100 text-red-800";
          break;
        case "high":
          colorClass = "bg-orange-100 text-orange-800";
          break;
        case "medium":
          colorClass = "bg-yellow-100 text-yellow-800";
          break;
        case "low":
          colorClass = "bg-blue-100 text-blue-800";
          break;
        case "info":
          colorClass = "bg-green-100 text-green-800";
          break;
      }
      
      // Capitalize first letter for display
      const displaySeverity = severity.charAt(0).toUpperCase() + severity.slice(1);
      
      return (
        <span className={`inline-flex items-center rounded-md px-2 py-1 text-xs font-medium ${colorClass}`}>
          {displaySeverity}
        </span>
      );
    }
  },
  {
    accessorKey: "cvss",
    header: "CVSS Score"
  },
  {
    accessorKey: "cve",
    header: "CVE ID",
    cell: ({ getValue }) => {
      const cve = getValue() as string | null;
      if (!cve) return "—";
      
      return cve;
    }
  },
  {
    accessorKey: "discovered_at",
    header: "Discovered Date",
    cell: ({ getValue }) => {
      const date = getValue() as string;
      if (!date) return "";
      return new Date(date).toLocaleDateString();
    }
  },
  {
    id: "actions",
    header: "Actions",
    cell: ({ row }) => {
      const vulnerability = row.original;
      return (
        <div className="flex items-center space-x-2">
          {/* These components will be replaced at runtime */}
        </div>
      );
    }
  }
]; 